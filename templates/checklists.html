{% extends 'layout.html' %}
{% set page_title = "Checklists" %}
{% block content %}

<div class="bg-white/70 dark:bg-white/5 border border-slate-900/10 dark:border-white/10 rounded-2xl shadow p-5">

  <div class="flex items-center justify-between mb-4">
    <h2 class="text-lg font-semibold text-slate-900 dark:text-white">Checklists</h2>

    <form method="get" class="flex gap-2">
      <input name="q" value="{{ q }}"
             placeholder="Buscar placa/tÃ©cnico/status..."
             class="border border-slate-900/10 dark:border-white/20
                    bg-white dark:bg-gray-900/50
                    text-slate-900 dark:text-gray-200
                    placeholder:text-slate-400 dark:placeholder:text-gray-500
                    rounded-lg px-3 py-2
                    focus:outline-none focus:ring-2 focus:ring-blue-600/40">
      <button class="bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-500 hover:to-blue-700 text-white rounded-lg px-4">
        Buscar
      </button>
    </form>
  </div>

  <form method="post" action="{{ url_for('checklists_import') }}" class="mb-4">
    <button class="bg-green-700 hover:bg-green-600 text-white rounded-lg px-4 py-2">
      Importar JSONs da pasta inbox/
    </button>
  </form>

  <!-- ======================= TABELA ======================= -->
  <div class="overflow-x-auto rounded-lg">
    <table class="min-w-full text-sm">

      <thead>
        <tr class="text-slate-600 dark:text-gray-300 border-b border-slate-900/10 dark:border-white/10 text-left">
          <th class="px-4 py-2 w-40">Data</th>
          <th class="px-4 py-2 w-32">Placa</th>
          <th class="px-4 py-2 w-40">TÃ©cnico</th>
          <th class="px-4 py-2 w-24 text-right">KM</th>
          <th class="px-4 py-2 w-32">Status</th>
          <th class="px-4 py-2 w-28 text-center">Detalhes</th>
        </tr>
      </thead>

      <tbody class="text-slate-900 dark:text-gray-200">

        {# namespace para controlar o grupo mÃªs/ano #}
        {% set ns = namespace(last_group=None) %}

        {% for c in itens %}

          {# pega mÃªs em nÃºmero e converte para PT #}
          {% set mes_num = c.date.strftime('%m') %}
          {% if mes_num == '01' %}
            {% set mes_pt = 'Janeiro' %}
          {% elif mes_num == '02' %}
            {% set mes_pt = 'Fevereiro' %}
          {% elif mes_num == '03' %}
            {% set mes_pt = 'MarÃ§o' %}
          {% elif mes_num == '04' %}
            {% set mes_pt = 'Abril' %}
          {% elif mes_num == '05' %}
            {% set mes_pt = 'Maio' %}
          {% elif mes_num == '06' %}
            {% set mes_pt = 'Junho' %}
          {% elif mes_num == '07' %}
            {% set mes_pt = 'Julho' %}
          {% elif mes_num == '08' %}
            {% set mes_pt = 'Agosto' %}
          {% elif mes_num == '09' %}
            {% set mes_pt = 'Setembro' %}
          {% elif mes_num == '10' %}
            {% set mes_pt = 'Outubro' %}
          {% elif mes_num == '11' %}
            {% set mes_pt = 'Novembro' %}
          {% elif mes_num == '12' %}
            {% set mes_pt = 'Dezembro' %}
          {% else %}
            {% set mes_pt = mes_num %}
          {% endif %}

          {% set grupo = mes_pt ~ ' de ' ~ c.date.strftime('%Y') %}

          {# sÃ³ mostra o cabeÃ§alho quando mudar mÃªs/ano #}
          {% if grupo != ns.last_group %}
            <tr class="bg-slate-900/5 dark:bg-white/5">
              <td colspan="6" class="px-4 py-2 text-blue-700 dark:text-blue-300 font-semibold uppercase tracking-wide">
                ðŸ“… {{ grupo }}
              </td>
            </tr>
            {% set ns.last_group = grupo %}
          {% endif %}

          <tr class="border-b border-slate-900/10 dark:border-white/10 hover:bg-slate-900/5 dark:hover:bg-white/5 transition">

            <!-- Data -->
            <td class="px-4 py-2 whitespace-nowrap">
              {{ c.date.strftime('%d/%m/%Y %H:%M') }}
            </td>

            <!-- Placa -->
            <td class="px-4 py-2">
              {{ c.vehicle.plate if c.vehicle else '-' }}
            </td>

            <!-- TÃ©cnico -->
            <td class="px-4 py-2">
              {{ c.technician or '-' }}
            </td>

            <!-- KM - alinhado Ã  direita -->
            <td class="px-4 py-2 text-right">
              {{ c.km }}
            </td>

            <!-- Status -->
            <td class="px-4 py-2">
              <span class="px-2 py-1 rounded-lg text-xs
                          bg-green-200/70 dark:bg-green-900/40
                          text-green-900 dark:text-green-200
                          border border-green-500/25 dark:border-green-700/40">
                {{ c.status }}
              </span>
            </td>

            <!-- Detalhes -->
            <td class="px-4 py-2 text-center">
              <a class="text-blue-700 dark:text-blue-400 underline"
                 href="{{ url_for('checklist_detail', cid=c.id) }}">
                 Ver
              </a>
            </td>

          </tr>

        {% else %}
          <tr>
            <td class="py-3 text-slate-500 dark:text-gray-400 text-center" colspan="6">
              Sem registros.
            </td>
          </tr>
        {% endfor %}
      </tbody>

    </table>
  </div>

</div>

{% endblock %}
