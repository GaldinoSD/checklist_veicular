{% extends 'layout.html' %}
{% set page_title = "Veículos" %}
{% block content %}

<div class="flex items-center justify-between mb-6">
    <h2 class="text-2xl font-semibold">Veículos</h2>

    {% if ROLE_ADMIN %}
    <button onclick="document.getElementById('modalNovoVeiculo').showModal()"
            class="px-4 py-2 rounded-lg bg-green-600 hover:bg-green-700 text-white font-semibold shadow-md">
        <i class="fa-solid fa-plus mr-1"></i> Novo veículo
    </button>
    {% endif %}
</div>

<!-- BUSCA -->
<form method="get" class="flex gap-2 mb-6">
  <input name="q" value="{{ q }}" placeholder="Buscar..."
         class="border border-white/20 bg-gray-900/50 rounded-lg px-3 py-2">
  <button class="bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-lg px-4">Buscar</button>
</form>

<!-- ================================
      LISTA DE VEÍCULOS
================================ -->
<div class="grid md:grid-cols-2 lg:grid-cols-3 gap-4">

  {% for v in veiculos %}
  {% set tipo = (v.type or 'carro')|lower %}

  {% if tipo == 'caminhao' %}
    {% set card_bg = 'bg-orange-900/20 border-orange-800/30 hover:bg-orange-900/30' %}
    {% set icon_class = 'fa-truck text-orange-400' %}
  {% elif tipo == 'moto' %}
    {% set card_bg = 'bg-yellow-900/20 border-yellow-800/30 hover:bg-yellow-900/30' %}
    {% set icon_class = 'fa-motorcycle text-yellow-400' %}
  {% elif tipo == 'van' %}
    {% set card_bg = 'bg-teal-900/20 border-teal-800/30 hover:bg-teal-900/30' %}
    {% set icon_class = 'fa-van-shuttle text-teal-400' %}
  {% else %}
    {% set card_bg = 'bg-blue-900/20 border-blue-800/30 hover:bg-blue-900/30' %}
    {% set icon_class = 'fa-car text-blue-400' %}
  {% endif %}

  <div class="rounded-2xl border {{ card_bg }} shadow p-5 relative overflow-hidden transition-all duration-200">

    <!-- Ícone -->
    <div class="absolute right-4 top-4 text-3xl opacity-80">
      <i class="fas {{ icon_class }}"></i>
    </div>

    <div class="flex items-center justify-between">
      <div>
        <div class="text-xs text-gray-400">Placa</div>
        <div class="text-xl font-bold tracking-wide">{{ v.plate }}</div>
      </div>

      {% set badge = 'bg-green-900/40 text-green-200 border-green-700/40' if v.status=='ATIVO'
                    else ('bg-red-900/40 text-red-200 border-red-700/40' if v.status=='INATIVO'
                    else 'bg-yellow-900/40 text-yellow-200 border-yellow-700/40') %}
      <span class="px-3 py-1 rounded-full text-xs border {{ badge }}">{{ v.status }}</span>
    </div>

    <div class="mt-4 grid grid-cols-2 gap-3 text-sm">
      <div><span class="opacity-70">Marca</span><div class="font-medium">{{ v.brand or '-' }}</div></div>
      <div><span class="opacity-70">Modelo</span><div class="font-medium">{{ v.model or '-' }}</div></div>
      <div><span class="opacity-70">Ano</span><div class="font-medium">{{ v.year or '-' }}</div></div>
      <div><span class="opacity-70">KM</span><div class="font-medium">{{ v.km or 0 }}</div></div>
      <div class="col-span-2"><span class="opacity-70">Tipo</span><div class="font-medium capitalize">{{ v.type or 'Não definido' }}</div></div>
    </div>

    {% if ROLE_ADMIN %}
    <div class="mt-4 flex items-center justify-between gap-2">

      <!-- Atualizar Status -->
      <form method="post" action="{{ url_for('vehicle_status', vid=v.id) }}" class="flex items-center gap-2">
        <select name="status" class="border border-white/20 bg-gray-900/60 rounded-lg px-2 py-1 text-sm">
          <option value="ATIVO" {% if v.status=='ATIVO' %}selected{% endif %}>ATIVO</option>
          <option value="MANUTENCAO" {% if v.status=='MANUTENCAO' %}selected{% endif %}>MANUTENÇÃO</option>
          <option value="INATIVO" {% if v.status=='INATIVO' %}selected{% endif %}>INATIVO</option>
        </select>
        <button class="bg-amber-600 hover:bg-amber-500 text-white rounded px-3 py-1 text-sm">Atualizar</button>
      </form>

      <!-- Editar -->
      <details class="w-auto">
        <summary class="cursor-pointer text-blue-300 hover:text-blue-200 text-sm">Editar</summary>
        <div class="mt-2 space-y-2">
          <form method="post" action="{{ url_for('vehicle_edit', vid=v.id) }}" class="grid grid-cols-2 gap-2">
            <input name="brand" value="{{ v.brand }}" class="border bg-gray-900/60 rounded px-2 py-1 text-sm">
            <input name="model" value="{{ v.model }}" class="border bg-gray-900/60 rounded px-2 py-1 text-sm">
            <input name="year" value="{{ v.year }}" class="border bg-gray-900/60 rounded px-2 py-1 text-sm">
            <input name="km" value="{{ v.km }}" class="border bg-gray-900/60 rounded px-2 py-1 text-sm">

            <select name="type" class="border bg-gray-900/60 rounded px-2 py-1 text-sm col-span-2">
              <option value="carro" {% if tipo == 'carro' %}selected{% endif %}>Carro</option>
              <option value="moto" {% if tipo == 'moto' %}selected{% endif %}>Moto</option>
              <option value="caminhao" {% if tipo == 'caminhao' %}selected{% endif %}>Caminhão</option>
              <option value="van" {% if tipo == 'van' %}selected{% endif %}>Van</option>
            </select>

            <button class="col-span-2 bg-indigo-600 hover:bg-indigo-500 text-white rounded px-3 py-1 text-sm">
              Salvar
            </button>
          </form>

          <form method="post" action="{{ url_for('vehicle_delete', vid=v.id) }}"
                onsubmit="return confirm('Excluir {{ v.plate }}?');">
            <button class="bg-red-700 hover:bg-red-600 text-white rounded px-3 py-1 text-sm w-full" type="submit">
              Excluir
            </button>
          </form>
        </div>
      </details>
    </div>

    {% endif %}
  </div>
  {% endfor %}
</div>

<!-- ============================================
        MODAL — NOVO VEÍCULO (LABELS EXTERNAS)
============================================ -->
<dialog id="modalNovoVeiculo"
        class="rounded-2xl bg-gray-900 border border-gray-700 p-6 shadow-2xl w-[420px]">

  <h2 class="text-xl font-bold text-white mb-4">Cadastrar novo veículo</h2>

  <form method="post" action="{{ url_for('vehicle_new') }}" class="space-y-4">

    <!-- Placa -->
    <div>
      <label class="text-sm text-gray-300 font-medium">Placa</label>
      <input name="plate"
             class="w-full bg-gray-800 border border-gray-600 rounded-lg px-3 py-2 
                    text-white focus:border-blue-500 focus:ring-2 focus:ring-blue-600"
             required>
    </div>

    <!-- Marca -->
    <div>
      <label class="text-sm text-gray-300 font-medium">Marca</label>
      <input name="brand"
             class="w-full bg-gray-800 border border-gray-600 rounded-lg px-3 py-2 
                    text-white focus:border-blue-500 focus:ring-2 focus:ring-blue-600">
    </div>

    <!-- Modelo -->
    <div>
      <label class="text-sm text-gray-300 font-medium">Modelo</label>
      <input name="model"
             class="w-full bg-gray-800 border border-gray-600 rounded-lg px-3 py-2 
                    text-white focus:border-blue-500 focus:ring-2 focus:ring-blue-600">
    </div>

    <!-- Ano -->
    <div>
      <label class="text-sm text-gray-300 font-medium">Ano</label>
      <input name="year" type="number"
             class="w-full bg-gray-800 border border-gray-600 rounded-lg px-3 py-2 
                    text-white focus:border-blue-500 focus:ring-2 focus:ring-blue-600">
    </div>

    <!-- KM -->
    <div>
      <label class="text-sm text-gray-300 font-medium">KM inicial</label>
      <input name="km" type="number" value="0"
             class="w-full bg-gray-800 border border-gray-600 rounded-lg px-3 py-2 
                    text-white focus:border-blue-500 focus:ring-2 focus:ring-blue-600">
    </div>

    <!-- Tipo -->
    <div>
      <label class="text-sm text-gray-300 font-medium">Tipo</label>
      <select name="type"
              class="w-full bg-gray-800 border border-gray-600 rounded-lg px-3 py-2 text-white
                     focus:border-blue-500 focus:ring-2 focus:ring-blue-600">
        <option value="carro">Carro</option>
        <option value="moto">Moto</option>
        <option value="caminhao">Caminhão</option>
        <option value="van">Van</option>
      </select>
    </div>

    <!-- Status -->
    <div>
      <label class="text-sm text-gray-300 font-medium">Status</label>
      <select name="status"
              class="w-full bg-gray-800 border border-gray-600 rounded-lg px-3 py-2 text-white
                     focus:border-blue-500 focus:ring-2 focus:ring-blue-600">
        <option value="ATIVO">ATIVO</option>
        <option value="MANUTENCAO">MANUTENÇÃO</option>
        <option value="INATIVO">INATIVO</option>
      </select>
    </div>

    <!-- Botões -->
    <div class="flex justify-end gap-2 pt-2">
      <button type="button"
              onclick="document.getElementById('modalNovoVeiculo').close()"
              class="px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg">
        Cancelar
      </button>

      <button class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white font-semibold rounded-lg">
        Cadastrar
      </button>
    </div>

  </form>
</dialog>



{% endblock %}
