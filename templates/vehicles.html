{% extends 'layout.html' %}
{% set page_title = "Ve√≠culos" %}
{% block content %}

<!-- ===============================
      CABE√áALHO + BUSCA + NOVO
================================ -->
<div class="flex flex-col lg:flex-row lg:items-center lg:justify-between mb-10 gap-4">

  <h2 class="text-3xl font-bold tracking-wide text-white drop-shadow">
    üöó Ve√≠culos
  </h2>

  <div class="flex items-center gap-3 w-full lg:w-auto">

      <!-- BUSCA -->
      <form method="get" class="flex items-center gap-2 flex-1">
        <input name="q" value="{{ q }}" placeholder="Buscar por placa, marca ou modelo..."
               class="flex-1 bg-gray-900/60 border border-white/10 rounded-xl px-4 py-2 text-gray-200 
                      focus:ring-2 focus:ring-blue-600 shadow">
        <button class="px-6 bg-blue-600 hover:bg-blue-500 rounded-xl text-white font-medium shadow">
          Buscar
        </button>
      </form>

      <!-- BOT√ÉO NOVO VE√çCULO -->
      {% if ROLE_ADMIN %}
      <button onclick="document.getElementById('modalNovoVeiculo').showModal()"
              class="px-5 py-2 bg-green-600 hover:bg-green-500 rounded-xl text-white font-semibold shadow-lg whitespace-nowrap">
          <i class="fa-solid fa-plus mr-1"></i> Novo
      </button>
      {% endif %}
  </div>
</div>

<!-- ===============================
      GRID DE CARDS (4 POR LINHA)
================================ -->
<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">

{% for v in veiculos %}
{% set tipo = (v.type or 'carro')|lower %}

{% if tipo == 'caminhao' %}
    {% set bg = 'bg-orange-900/40 border-orange-700/60 hover:bg-orange-900/50' %}
    {% set icon = 'fa-truck text-orange-300' %}
{% elif tipo == 'moto' %}
    {% set bg = 'bg-yellow-900/40 border-yellow-700/60 hover:bg-yellow-900/50' %}
    {% set icon = 'fa-motorcycle text-yellow-300' %}
{% elif tipo == 'van' %}
    {% set bg = 'bg-teal-900/40 border-teal-700/60 hover:bg-teal-900/50' %}
    {% set icon = 'fa-van-shuttle text-teal-300' %}
{% else %}
    {% set bg = 'bg-blue-900/40 border-blue-700/60 hover:bg-blue-900/50' %}
    {% set icon = 'fa-car text-blue-300' %}
{% endif %}

<!-- NORMALIZAR STATUS -->
{% set status = (v.status or '').strip().upper() %}

<!-- ========================
        CARD PREMIUM ULTRA
========================= -->
<div class="group relative rounded-2xl border {{ bg }} shadow-xl p-5 
            overflow-hidden transition-all duration-300 
            hover:scale-[1.04] hover:shadow-blue-900/40 hover:-translate-y-1 
            backdrop-blur-xl bg-opacity-40 border-opacity-40">

    <!-- BARRA LATERAL COLORIDA -->
    <div class="absolute left-0 top-0 h-full w-1.5 
                {% if tipo == 'caminhao' %} bg-orange-400 
                {% elif tipo == 'moto' %} bg-yellow-400 
                {% elif tipo == 'van' %} bg-teal-400 
                {% else %} bg-blue-400 {% endif %}">
    </div>

    <!-- √çCONE GIGANTE NO FUNDO -->
    <i class="fa-solid {{ icon }} absolute right-3 bottom-2 text-7xl opacity-[0.07]"></i>

    <!-- T√çTULO (PLACA MERCOSUL) + STATUS -->
    <div class="flex justify-between items-start mb-4">

        <!-- PLACA MERCOSUL -->
        <div class="select-none">
            <!-- Faixa superior -->
            <div class="relative bg-blue-700 text-white w-36 rounded-t-md border border-blue-900 shadow">
                <div class="flex items-center justify-between px-2 py-0.5">
                    <svg width="22" height="10" viewBox="0 0 22 14" fill="none">
                        <circle cx="3" cy="7" r="1" fill="white"/>
                        <circle cx="7" cy="5" r="1" fill="white"/>
                        <circle cx="11" cy="6.5" r="1" fill="white"/>
                        <circle cx="15" cy="4.5" r="1" fill="white"/>
                        <circle cx="19" cy="7" r="1" fill="white"/>
                    </svg>
                    <span class="text-[10px] font-bold tracking-wide">BRASIL</span>
                    <div class="w-5 h-3 bg-green-600 relative flex items-center justify-center border border-white">
                        <div class="w-3 h-3 bg-yellow-400 rotate-45 absolute"></div>
                        <div class="w-2 h-2 bg-blue-700 rounded-full absolute"></div>
                    </div>
                </div>
            </div>

            <!-- Campo da placa -->
            <div class="bg-white text-black font-extrabold text-lg 
                        px-3 py-1 tracking-[0.12em] shadow-md 
                        border border-gray-400 rounded-b-md text-center font-mono">
                {{ v.plate }}
            </div>
        </div>

        <!-- STATUS -->
        <span class="px-3 py-1 rounded-lg text-xs font-semibold border shadow-sm
            {% if status == 'ATIVO' %}
                bg-green-800/60 text-green-200 border-green-600/40
            {% elif status == 'INATIVO' %}
                bg-red-800/60 text-red-200 border-red-600/40
            {% elif status in ['MANUTENCAO','MANUTEN√á√ÉO'] %}
                bg-yellow-800/60 text-yellow-200 border-yellow-600/40
            {% else %}
                bg-gray-700/60 text-gray-300 border-gray-500/40
            {% endif %}">
            {{ v.status }}
        </span>
    </div>

    <div class="border-t border-white/10 mb-4"></div>

    <!-- TABELA DE INFORMA√á√ïES -->
    <div class="text-sm text-gray-200 space-y-1.5">

        <div class="flex justify-between">
            <span class="text-gray-400 flex items-center gap-2">
                <i class="fa-solid fa-tag text-gray-500"></i> Marca:
            </span>
            <span class="font-medium">{{ v.brand or '-' }}</span>
        </div>

        <div class="flex justify-between">
            <span class="text-gray-400 flex items-center gap-2">
                <i class="fa-solid fa-car-side text-gray-500"></i> Modelo:
            </span>
            <span class="font-medium">{{ v.model or '-' }}</span>
        </div>

        <div class="flex justify-between">
            <span class="text-gray-400 flex items-center gap-2">
                <i class="fa-solid fa-calendar text-gray-500"></i> Ano:
            </span>
            <span class="font-medium">{{ v.year or '-' }}</span>
        </div>

        <div class="flex justify-between">
            <span class="text-gray-400 flex items-center gap-2">
                <i class="fa-solid fa-road text-gray-500"></i> KM:
            </span>
            <span class="font-medium">{{ v.km or 0 }}</span>
        </div>

        <div class="flex justify-between">
            <span class="text-gray-400 flex items-center gap-2">
                <i class="fa-solid fa-layer-group text-gray-500"></i> Tipo:
            </span>
            <span class="font-medium capitalize">
                {{ v.type or 'N√£o definido' }}
            </span>
        </div>

    </div>

    <!-- BOT√ïES -->
    {% if ROLE_ADMIN %}
    <div class="mt-5 border-t border-white/10 pt-4 flex justify-between gap-3">

        <button onclick="document.getElementById('edit{{ v.id }}').showModal()"
                class="px-3 py-1.5 text-sm bg-blue-600 hover:bg-blue-500 rounded-lg 
                       text-white shadow font-medium transition-all duration-150">
            Editar
        </button>

        <form method="post" action="{{ url_for('vehicle_delete', vid=v.id) }}"
              onsubmit="return confirm('Excluir ve√≠culo {{ v.plate }}?');">
          <button class="px-3 py-1.5 text-sm bg-red-700 hover:bg-red-600 rounded-lg text-white shadow">
            Excluir
          </button>
        </form>
    </div>
    {% endif %}
</div>

<!-- MODAL DE EDI√á√ÉO -->
<dialog id="edit{{ v.id }}"
        class="rounded-2xl bg-gray-900 border border-gray-700 p-6 shadow-2xl w-[430px]">

  <h2 class="text-xl font-bold mb-4 text-white">
    Editar ve√≠culo ‚Äî {{ v.plate }}
  </h2>

  <form method="post" action="{{ url_for('vehicle_edit', vid=v.id) }}" class="space-y-4">

    <div>
      <label class="text-sm text-gray-300">Marca</label>
      <input name="brand" value="{{ v.brand }}"
             class="w-full bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-white">
    </div>

    <div>
      <label class="text-sm text-gray-300">Modelo</label>
      <input name="model" value="{{ v.model }}"
             class="w-full bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-white">
    </div>

    <div class="grid grid-cols-2 gap-3">
      <div>
        <label class="text-sm text-gray-300">Ano</label>
        <input type="number" name="year" value="{{ v.year }}"
               class="w-full bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-white">
      </div>

      <div>
        <label class="text-sm text-gray-300">KM</label>
        <input type="number" name="km" value="{{ v.km }}"
               class="w-full bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-white">
      </div>
    </div>

    <div>
      <label class="text-sm text-gray-300">Tipo</label>
      <select name="type"
              class="w-full bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-white">
        <option value="carro" {% if tipo=='carro' %}selected{% endif %}>Carro</option>
        <option value="moto" {% if tipo=='moto' %}selected{% endif %}>Moto</option>
        <option value="caminhao" {% if tipo=='caminhao' %}selected{% endif %}>Caminh√£o</option>
        <option value="van" {% if tipo=='van' %}selected{% endif %}>Van</option>
      </select>
    </div>

    <div>
      <label class="text-sm text-gray-300">Status</label>
      <select name="status"
              class="w-full bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-white">
        <option value="ATIVO" {% if status=='ATIVO' %}selected{% endif %}>ATIVO</option>
        <option value="MANUTENCAO" {% if status in ['MANUTENCAO','MANUTEN√á√ÉO'] %}selected{% endif %}>MANUTEN√á√ÉO</option>
        <option value="INATIVO" {% if status=='INATIVO' %}selected{% endif %}>INATIVO</option>
      </select>
    </div>

    <div class="flex justify-end gap-3 pt-3">
      <button type="button"
              onclick="document.getElementById('edit{{ v.id }}').close()"
              class="px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg text-white">
        Cancelar
      </button>

      <button class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg text-white font-semibold">
        Salvar
      </button>
    </div>

  </form>
</dialog>

{% endfor %}
</div>

<!-- MODAL NOVO VE√çCULO -->
<dialog id="modalNovoVeiculo"
        class="rounded-2xl bg-gray-900 border border-gray-700 p-6 shadow-2xl w-[420px]">

  <h2 class="text-xl font-bold text-white mb-4">Cadastrar novo ve√≠culo</h2>

  <form method="post" action="{{ url_for('vehicle_new') }}" class="space-y-4">

    <div>
      <label class="text-sm text-gray-300">Placa</label>
      <input name="plate" required
             class="w-full bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-white">
    </div>

    <div>
      <label class="text-sm text-gray-300">Marca</label>
      <input name="brand"
             class="w-full bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-white">
    </div>

    <div>
      <label class="text-sm text-gray-300">Modelo</label>
      <input name="model"
             class="w-full bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-white">
    </div>

    <div>
      <label class="text-sm text-gray-300">Ano</label>
      <input type="number" name="year"
             class="w-full bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-white">
    </div>

    <div>
      <label class="text-sm text-gray-300">KM inicial</label>
      <input type="number" name="km" value="0"
             class="w-full bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-white">
    </div>

    <div>
      <label class="text-sm text-gray-300">Tipo</label>
      <select name="type"
              class="w-full bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-white">
        <option value="carro">Carro</option>
        <option value="moto">Moto</option>
        <option value="caminhao">Caminh√£o</option>
        <option value="van">Van</option>
      </select>
    </div>

    <div>
      <label class="text-sm text-gray-300">Status</label>
      <select name="status"
              class="w-full bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-white">
        <option value="ATIVO">ATIVO</option>
        <option value="MANUTENCAO">MANUTEN√á√ÉO</option>
        <option value="INATIVO">INATIVO</option>
      </select>
    </div>

    <div class="flex justify-end gap-3 pt-3">
      <button type="button"
              onclick="document.getElementById('modalNovoVeiculo').close()"
              class="px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg text-white">
        Cancelar
      </button>

      <button class="px-4 py-2 bg-green-600 hover:bg-green-700 rounded-lg text-white font-semibold">
        Cadastrar
      </button>
    </div>

  </form>
</dialog>

{% endblock %}
