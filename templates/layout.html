<!doctype html>
<html lang="pt-BR" class="h-full">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{{ page_title or 'Sistema' }}</title>

    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <link rel="shortcut icon" type="image/x-icon" href="{{ url_for('static', filename='favicon-v2.ico') }}">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

    <!-- Tailwind config (opcional) -->
    <script>
      tailwind.config = {
        theme: {
          extend: {
            boxShadow: {
              glass: "0 18px 60px rgba(0,0,0,.45)",
            }
          }
        }
      }
    </script>

    <style>
      /* ‚úÖ N√£o coloque transition em tudo (pega input, table, etc). */
      a, button, .transit {
        transition: 0.15s ease-in-out;
      }

      /* =========================
         ‚úÖ FUNDO PREMIUM (SEM "FAIXAS" / BANDAS)
         - Camadas + noise leve
      ========================== */
      body {
        background: #020617; /* base s√≥lida */
        color: #f3f4f6;
        min-height: 100vh;
        position: relative;
        overflow-x: hidden;
      }

      /* Camadas de glow (radial) por tr√°s */
      body::after {
        content: "";
        position: fixed;
        inset: 0;
        z-index: -2;
        background:
          radial-gradient(ellipse at top, rgba(59,130,246,.18), transparent 55%),
          radial-gradient(ellipse at bottom, rgba(168,85,247,.14), transparent 60%),
          radial-gradient(ellipse at left, rgba(16,185,129,.10), transparent 55%),
          radial-gradient(ellipse at right, rgba(245,158,11,.08), transparent 55%);
      }

      /* Noise leve (remove o efeito de ‚Äúreparti√ß√£o‚Äù) */
      body::before {
        content: "";
        position: fixed;
        inset: 0;
        z-index: -1;
        pointer-events: none;
        opacity: .06;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='180' height='180'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.9' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='180' height='180' filter='url(%23n)' opacity='.35'/%3E%3C/svg%3E");
      }

      /* Vidro premium */
      .glass {
        background: rgba(255, 255, 255, 0.08);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
      }

      /* ===== User chip premium (compacto - n√£o estoura header) ===== */
      .userchip {
        background: rgba(255,255,255,0.06);
        border: 1px solid rgba(255,255,255,0.12);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
      }

      .userchip:hover {
        background: rgba(255,255,255,0.085);
        border-color: rgba(255,255,255,0.18);
      }

      .userchip-name {
        background: linear-gradient(90deg, #ffffff, #9ecbff);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }

      .userchip-dot {
        box-shadow: 0 0 0 2px rgba(0,0,0,.25);
      }

      .userchip-glow-admin {
        box-shadow: 0 0 0 1px rgba(250,204,21,.25), 0 0 14px rgba(250,204,21,.35);
      }
      .userchip-glow-default {
        box-shadow: 0 0 0 1px rgba(59,130,246,.22), 0 0 12px rgba(59,130,246,.28);
      }
    </style>
  </head>

  <!-- ‚úÖ Removi o bg-gradient daqui -->
  <body class="min-h-screen text-gray-100">

    <!-- ============================
          CABE√áALHO MODERNO PREMIUM
    ============================== -->
    <header class="glass border-b border-white/20 sticky top-0 z-50 shadow-glass">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 py-2 flex items-center justify-between gap-3">

        <!-- LOGO -->
        <a href="{{ url_for('dashboard') if current_user.is_authenticated else url_for('login') }}"
           class="flex items-center gap-3 shrink-0">
          <img src="{{ url_for('static', filename='logo.png') }}"
               class="h-7 w-auto object-contain drop-shadow"
               alt="Logo">
        </a>

        {% if current_user.is_authenticated and (ROLE_ADMIN or ROLE_SUPERVISOR) %}

        {% set menu_items = [
          ('Dashboard', 'dashboard'),
          ('Ve√≠culos', 'vehicles'),
          ('Checklists', 'checklists'),
          ('Vistoria', 'vistorias_list'),
          ('Entrada / Sa√≠da', 'controle_veiculos'),
          ('Relat√≥rios', 'reports'),
          ('Avarias / O.S.', 'avarias_registro')
        ] %}

        <!-- MENU DESKTOP (mais compacto) -->
        <nav class="hidden md:flex items-center gap-1 text-[12px] font-medium mx-auto px-1.5">
          {% for label, route in menu_items %}
            {% set is_active = (request.endpoint == route) %}
            <a href="{{ url_for(route) }}"
               class="px-2.5 py-1 rounded-md font-medium tracking-wide border border-transparent text-[12px]
                      {% if is_active %}
                        bg-blue-600/20 text-white border-blue-500/25
                      {% else %}
                        text-gray-300 hover:text-white hover:bg-white/5 hover:border-white/10
                      {% endif %}">
              {{ label }}
            </a>
          {% endfor %}

          {% if ROLE_ADMIN %}
            <span class="w-px h-5 bg-white/15 mx-1.5"></span>

            {% set is_users = (request.endpoint == 'users') %}
            <a href="{{ url_for('users') }}"
               class="px-2.5 py-1 rounded-md border border-transparent text-[12px]
                      {% if is_users %}
                        bg-blue-600/20 text-white border-blue-500/25
                      {% else %}
                        text-gray-300 hover:text-white hover:bg-white/5 hover:border-white/10
                      {% endif %}">
              Usu√°rios
            </a>

            {% set is_cfg = (request.endpoint == 'config_checklist') %}
            <a href="{{ url_for('config_checklist') }}"
               class="px-2.5 py-1 rounded-md border border-transparent text-[12px]
                      {% if is_cfg %}
                        bg-blue-600/20 text-white border-blue-500/25
                      {% else %}
                        text-gray-300 hover:text-white hover:bg-white/5 hover:border-white/10
                      {% endif %}">
              Configura√ß√µes
            </a>

            {% set is_logs = (request.endpoint == 'logs') %}
            <a href="{{ url_for('logs') }}"
               class="px-2.5 py-1 rounded-md border border-transparent text-[12px]
                      {% if is_logs %}
                        bg-yellow-600/15 text-white border-yellow-500/25
                      {% else %}
                        text-gray-300 hover:text-white hover:bg-white/5 hover:border-white/10
                      {% endif %}">
              Logs
            </a>
          {% endif %}
        </nav>

        <!-- BOT√ÉO MOBILE (HAMBURGUER) -->
        <button type="button"
                id="btnMobileMenu"
                class="md:hidden px-3 py-2 rounded-lg border border-white/15 bg-white/5 hover:bg-white/10 transit text-sm"
                aria-expanded="false"
                aria-controls="mobileMenu">
          ‚ò∞
        </button>

        {% endif %}

        <!-- PERFIL + SAIR (tudo junto e compacto) -->
        <div class="flex items-center gap-2.5 shrink-0">
          {% if current_user.is_authenticated %}

            {% set role_label = 'T√©cnico' %}
            {% if request.endpoint in ['checklist_mobile', 'manutencao_os'] %}
              {% set role_label = 'Colaborador' %}
            {% else %}
              {% if ROLE_ADMIN %}
                {% set role_label = 'Administrador' %}
              {% elif ROLE_SUPERVISOR %}
                {% set role_label = 'Supervisor' %}
              {% endif %}
            {% endif %}

            <!-- CHIP PREMIUM COM SAIR DENTRO (mais compacto) -->
            <div class="hidden sm:flex items-center gap-2.5 pl-2 pr-2 py-1 rounded-2xl userchip transit">

              <!-- avatar -->
              <div class="w-8 h-8 rounded-xl flex items-center justify-center font-extrabold text-white shadow text-sm
                {% if ROLE_ADMIN %}
                  bg-gradient-to-br from-yellow-400 to-yellow-300 text-black userchip-glow-admin
                {% else %}
                  bg-gradient-to-br from-blue-700 to-blue-500 userchip-glow-default
                {% endif %}">
                {{ current_user.username[0] | upper }}
              </div>

              <!-- nome + papel (mais compacto) -->
              <div class="leading-tight min-w-0">
                <div class="text-[13px] font-extrabold userchip-name max-w-[130px] truncate">
                  {{ current_user.username }}
                </div>

                <div class="flex items-center gap-1.5 mt-0.5 text-[10px] text-gray-300">
                  <!-- status dot -->
                  <span class="w-2 h-2 rounded-full bg-emerald-400 userchip-dot"></span>

                  <span class="px-1.5 py-0.5 rounded-full border border-white/10 bg-white/5 whitespace-nowrap">
                    {{ role_label }}
                  </span>

                  {% if ROLE_ADMIN %}
                    <span class="text-yellow-300">üëë</span>
                  {% endif %}
                </div>
              </div>

              <!-- divisor -->
              <span class="w-px h-6 bg-white/10 mx-1"></span>

              <!-- sair dentro do chip (mais compacto) -->
              <a href="{{ url_for('logout') }}"
                 class="px-2.5 py-1 rounded-lg text-[11px] font-semibold
                        bg-red-600/20 border border-red-600/30 text-red-100
                        hover:bg-red-600/30 hover:border-red-500/40 transit whitespace-nowrap">
                Sair
              </a>
            </div>

            <!-- Mobile: mant√©m s√≥ bot√£o sair -->
            <a href="{{ url_for('logout') }}"
               class="sm:hidden px-3 py-1.5 rounded-xl text-sm bg-red-600/25 border border-red-600/35
                      hover:bg-red-600/35 hover:text-red-100 transit">
              Sair
            </a>

          {% else %}
            <a href="{{ url_for('login') }}" class="text-sm hover:text-blue-400 transit">
              Login
            </a>
          {% endif %}
        </div>

      </div>

      <!-- MENU MOBILE (dropdown) -->
      {% if current_user.is_authenticated and (ROLE_ADMIN or ROLE_SUPERVISOR) %}
      <div id="mobileMenu" class="md:hidden hidden border-t border-white/10">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 py-3 flex flex-col gap-2">

          {% for label, route in menu_items %}
            {% set is_active = (request.endpoint == route) %}
            <a href="{{ url_for(route) }}"
               class="px-2.5 py-1.5 rounded-lg text-[12px] font-medium border border-transparent
                      {% if is_active %}
                        bg-blue-600/20 text-white border-blue-500/25
                      {% else %}
                        text-gray-300 hover:text-white hover:bg-white/5 hover:border-white/10
                      {% endif %}">
              {{ label }}
            </a>
          {% endfor %}

          {% if ROLE_ADMIN %}
            <div class="h-px bg-white/10 my-2"></div>

            <a href="{{ url_for('users') }}"
               class="px-2.5 py-1.5 rounded-lg text-[12px] font-medium border border-transparent
                      text-gray-300 hover:text-white hover:bg-white/5 hover:border-white/10">
              Usu√°rios
            </a>

            <a href="{{ url_for('config_checklist') }}"
               class="px-2.5 py-1.5 rounded-lg text-[12px] font-medium border border-transparent
                      text-gray-300 hover:text-white hover:bg-white/5 hover:border-white/10">
              Configura√ß√µes
            </a>

            <a href="{{ url_for('logs') }}"
               class="px-2.5 py-1.5 rounded-lg text-[12px] font-medium border border-transparent
                      text-gray-300 hover:text-white hover:bg-yellow-600/10 hover:border-yellow-500/20">
              Logs
            </a>
          {% endif %}
        </div>
      </div>
      {% endif %}
    </header>

    <!-- ============================
          CONTE√öDO PRINCIPAL
    ============================== -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 py-6">

      {% with msgs = get_flashed_messages(with_categories=true) %}
        {% if msgs %}
          <div class="space-y-2 mb-4">
            {% for cat, msg in msgs %}
              <div class="px-4 py-2 rounded-lg text-sm border
                  {% if cat == 'success' %} bg-green-800/40 border-green-600/40 text-green-200
                  {% elif cat == 'error' %} bg-red-800/40 border-red-600/40 text-red-200
                  {% else %} bg-white/10 border-white/20 text-gray-100
                  {% endif %}">
                {{ msg }}
              </div>
            {% endfor %}
          </div>
        {% endif %}
      {% endwith %}

      {% block content %}{% endblock %}
    </main>

    <script>
      // Mobile menu toggle (seguro mesmo se n√£o existir)
      (function () {
        const btn = document.getElementById("btnMobileMenu");
        const menu = document.getElementById("mobileMenu");
        if (!btn || !menu) return;

        btn.addEventListener("click", () => {
          const isOpen = !menu.classList.contains("hidden");
          menu.classList.toggle("hidden");
          btn.setAttribute("aria-expanded", String(!isOpen));
        });
      })();
    </script>
  </body>
</html>
